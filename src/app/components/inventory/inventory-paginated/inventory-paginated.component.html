<div class="container mx-auto px-4 py-8">
  <!-- Add create button next to filters -->
  <div class="mb-6 bg-white rounded-lg shadow p-4">
    <!-- Update the header section for better mobile layout -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 sm:gap-0 mb-4">
      <h2 class="text-lg font-semibold">Inventario</h2>
      <button
        (click)="toggleModal()"
        class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center justify-center"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
        </svg>
        Nuevo Item
      </button>
    </div>
    <!-- Add search and filters section -->
    <div class="mb-6 bg-white rounded-lg shadow p-4">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
        <!-- Search input -->
        <div class="col-span-1 md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            placeholder="Buscar por serial, tipo, marca..."
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
        </div>

        <!-- Type filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
          <select
            [(ngModel)]="selectedType"
            (change)="onFilterChange()"
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
            <option [ngValue]="0">Todos</option>
            <option *ngFor="let type of typeOptions" [ngValue]="type.id">{{type.value}}</option>
          </select>
        </div>

        <!-- Brand filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Marca</label>
          <select
            [(ngModel)]="selectedBrand"
            (change)="onFilterChange()"
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
            <option [ngValue]="0">Todas</option>
            <option *ngFor="let brand of brandOptions" [ngValue]="brand.id">{{brand.value}}</option>
          </select>
        </div>

        <!-- Status filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
          <select
            [(ngModel)]="selectedStatus"
            (change)="onFilterChange()"
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
            <option [ngValue]="0">Todos</option>
            <option *ngFor="let status of statusOptions" [ngValue]="status.id">{{status.value}}</option>
          </select>
        </div>

        <!-- Add Export button -->
        <div class="col-span-1 lg:col-span-5 flex justify-end mt-4">
          <button
            (click)="exportToExcel()"
            [disabled]="isLoading"
            class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
            {{ isLoading ? 'Exportando...' : 'Exportar a Excel' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Existing content (loading, error, table) continues here -->
    <div *ngIf="isLoading" class="flex justify-center items-center p-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
    </div>

    <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
      {{ errorMessage }}
    </div>

    <div *ngIf="!isLoading && !errorMessage" class="overflow-x-auto bg-white rounded-lg shadow">
      <!-- Mobile view -->
      <!-- Mobile view - Add delete button -->
      <div class="block md:hidden">
        <div *ngFor="let item of inventoryItems" class="p-4 border-b">
          <div class="grid grid-cols-2 gap-2">
            <div class="text-gray-600">ID:</div>
            <div>{{ item.id }}</div>
            <div class="text-gray-600">Serial:</div>
            <div>{{ item.serial }}</div>
            <div class="text-gray-600">Tipo:</div>
            <div>{{ item.tipo }}</div>
            <div class="text-gray-600">Marca:</div>
            <div>{{ item.marca }}</div>
            <div class="text-gray-600">Estado:</div>
            <div><span [class]="'px-2 py-1 rounded-full text-xs ' + getStatusClass(item.estado)">{{ item.estado }}</span></div>
            <div class="text-gray-600">Asignado a:</div>
            <div>{{ item.asignadoA || 'No asignado' }}</div>
            <div class="text-gray-600">Acciones:</div>
            <div>
              <button
                (click)="deleteItem(item.id)"
                class="text-white bg-red-600 hover:bg-red-700 px-3 py-1 rounded-md text-sm"
              >
                Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Desktop view - Add header and column -->
      <table class="hidden md:table min-w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serial</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marca</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ubicación</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Asignado a</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let item of inventoryItems" class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.id }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.serial }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.tipo }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.marca }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <span [class]="'px-2 py-1 rounded-full text-xs ' + getStatusClass(item.estado)">{{ item.estado }}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.ubicacion }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ item.asignadoA || 'No asignado' }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <button
                (click)="deleteItem(item.id)"
                class="text-white bg-red-600 hover:bg-red-700 px-3 py-1 rounded-md"
              >
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Remove the first paginator and keep only this one at the end -->
      <!-- Pagination -->
      <div class="px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
        <div class="flex-1 flex justify-between sm:hidden">
          <button 
            [disabled]="currentPage === 0"
            (click)="onPageChange(currentPage - 1)"
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400">
            Anterior
          </button>
          <button 
            [disabled]="currentPage >= totalPages - 1"
            (click)="onPageChange(currentPage + 1)"
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400">
            Siguiente
          </button>
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
          <div>
            <p class="text-sm text-gray-700">
              Mostrando página <span class="font-medium">{{ currentPage + 1 }}</span> de <span class="font-medium">{{ totalPages }}</span>
            </p>
          </div>
          <div>
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
              <button 
                [disabled]="currentPage === 0"
                (click)="onPageChange(currentPage - 1)"
                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400">
                <span class="sr-only">Anterior</span>
                &larr;
              </button>
              <button 
                [disabled]="currentPage >= totalPages - 1"
                (click)="onPageChange(currentPage + 1)"
                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400">
                <span class="sr-only">Siguiente</span>
                &rarr;
              </button>
            </nav>
          </div>
        </div>
      </div>
    </div>

    <!-- Add modal with improved mobile layout -->
    <div *ngIf="showModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
      <div class="relative mx-auto p-4 sm:p-5 border w-full sm:max-w-lg shadow-lg rounded-md bg-white my-8">
        <div class="mt-3">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-medium leading-6 text-gray-900">Crear Nuevo Item</h3>
            <button 
              type="button"
              (click)="toggleModal()"
              class="text-gray-400 hover:text-gray-500">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <form (ngSubmit)="createItem()" class="space-y-4">
            <!-- Basic inputs -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Serial</label>
              <input type="text" [(ngModel)]="newItem.serialNumber" name="serialNumber" 
                     class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Número de Inventario</label>
              <input type="text" [(ngModel)]="newItem.inventoryNumber" name="inventoryNumber" 
                     class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Descripción</label>
              <textarea [(ngModel)]="newItem.description" name="description" rows="3"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
            </div>

            <!-- Grid layout for selects -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Tipo</label>
                <select [(ngModel)]="newItem.itemTypeId" name="itemTypeId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar tipo</option>
                  <option *ngFor="let type of typeOptions" [value]="type.id">{{type.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Marca</label>
                <select [(ngModel)]="newItem.brandId" name="brandId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar marca</option>
                  <option *ngFor="let brand of brandOptions" [value]="brand.id">{{brand.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Modelo</label>
                <select [(ngModel)]="newItem.modelId" name="modelId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar modelo</option>
                  <option *ngFor="let model of modelOptions" [value]="model.id">{{model.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Origen</label>
                <select [(ngModel)]="newItem.sourceId" name="sourceId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar origen</option>
                  <option *ngFor="let source of sourceOptions" [value]="source.id">{{source.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Área</label>
                <select [(ngModel)]="newItem.assignedAreaId" name="assignedAreaId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar área</option>
                  <option *ngFor="let area of areaOptions" [value]="area.id">{{area.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Sub Área</label>
                <select [(ngModel)]="newItem.assignedSubAreaId" name="assignedSubAreaId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar sub área</option>
                  <option *ngFor="let subArea of subAreaOptions" [value]="subArea.id">{{subArea.value}}</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Estado</label>
                <select [(ngModel)]="newItem.statusId" name="statusId"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                  <option [ngValue]="0">Seleccionar estado</option>
                  <option *ngFor="let status of statusOptions" [value]="status.id">{{status.value}}</option>
                </select>
              </div>
            </div>

            <div class="flex flex-col-reverse sm:flex-row justify-end gap-3 mt-5">
              <button type="button" 
                      (click)="toggleModal()"
                      class="w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                Cancelar
              </button>
              <button type="submit"
                      [disabled]="isLoading"
                      class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50">
                {{ isLoading ? 'Guardando...' : 'Guardar' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    
  </div>
</div>